# Project Scenario
Implementing a Vulnerability Management (VM) program for a small company with 1000 client endpoints and 200 servers.

<p align="center">
<img width=75%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/f02008c7-002f-449c-b915-38bde4c501e9">
</p>

# Technology Utilized
- Tenable (enterprise vulnerability management platform)
- Azure Virtual Machines (Nessus scan engine + scan targets)
- PowerShell & BASH (remediation scripts)

# Project Phases
1. [Vulnerability Management Policy Draft Creation](#vulnerability-management-policy-draft-creation)
2. [Server Team Meeting: Vulnerability Management Policy Buy-In](#vulnerability-management-policy-buy-in)
3. [Vulnerability Management Policy Sign-Off](#vulnerability-management-policy-sign-off)
4. [Server Team Meeting: Initial Discovery Scan](#server-team-meeting-initial-discovery-scan)
5. [Conducting the Initial Vulnerability Scan](#conducting-the-initial-vulnerability-scan)
6. [Vulnerability Assessment and Prioritization](#vulnerability-assessment-and-prioritization)
7. [Server Team Meeting: Post-Initial Discovery Scan](#server-team-meeting-post-initial-discovery-scan)
8. [Creation of PowerShell Remediation Packages](#creation-of-powershell-remediation-packages)
9. [CAB Meeting: Change Request for Patching Insecure Protocols and Cipher Suites](#cab-meeting-change-request-for-patching-insecure-protocols-and-cipher-suites)
10. [Vulnerability Remediation Phases](#vulnerability-remediation-phases)
    - [Remediation (Round 1): Third Party Software Removal (Wireshark)](#remediation-round-1-third-party-software-removal-wireshark)
    - [Remediation (Round 2): Windows OS Secure Configuration (Protocols & Ciphers)](#remediation-round-2-windows-os-secure-configuration-protocols--ciphers)
    - [Remediation (Round 3): Windows OS Secure Configuration (Guest Account Group Membership)](#remediation-round-3-windows-os-secure-configuration-guest-account-group-membership)
    - [Remediation (Round 4): Windows OS Updates](#remediation-round-4-windows-os-updates)

## Vulnerability Management Policy Draft Creation
During this phase, a boilerplate Vulnerability Management Policy was drafted up using ChatGPT using the following prompt:
```
Create a Vulnerability Management policy including sections on
Policy Overview, Scope, Responsibilities, Scan Schedule,
Remediation Schedule, Maintenance Plans, Non-Compliance Consequences,
Sign-Off, and Review and Revision. Include details for each section.
```
The policy was then slightly adjusted to fit the needs of the organization to create the initial draft. This initial draft will be used to identify capability gaps and gain buy-in from the stakeholders and other departments:

[Vulnerability Management Policy (Draft)](https://docs.google.com/document/d/1CLSWm1_9JL1oUqgyNNwtPXW6FzXJ7ddVnSAUQTyqC8I/edit)


## Vulnerability Management Policy Buy-In
During this phase, the VM Program Manager will schedule meetings with all teams that will be affected by the new program and discuss the proposed VM Policy. During these meetings, awareness is spread about the program and the teams will have a chance provide feedback on the policy as it relates to their role and/or capability. For example, one department may feel the remediation cadence defined in the policy is too aggressive for their staff they have available.
<p align="center">
<img width="50%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/84d3fa34-f382-4557-bba1-c7b4da115524">
</p>


## Vulnerability Management Policy Sign-Off
During this phase, feedback from the teams is taken into consideration, including adjustments to the scan and remediation cadence and non-compliance statements. Based on this feedback, a final draft of the policy is created. The final draft is then reviewed and signed off by the Chief Information Officer (CIO), Chief Information Security Officer (CISO), the Chief Executive Officer (CEO), and any other stakeholders.

[Vulnerability Management Policy (FINAL DRAFT)](https://docs.google.com/document/d/1rvueLX_71pOR8ldN9zVW9r_zLzDQxVsnSUtNar8ftdg/edit)
<p align="center">
<img width="50%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/b8424583-7408-4354-b0e5-c1836b663f15">
</p>

## Server Team Meeting: Initial Discovery Scan
During this phase, meetings will be conducted with the relevant teams (server team, network team, etc.) to discuss the initial scanning of resources. These meetings provide an opportunity for the teams to raise any concerns and address potential issues related vulnerability scanning.
<p align="center">
<img width="50%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/f86eefa0-b951-4322-ae5f-456d6d2e88ad">
</p>


## Conducting the Initial Vulnerability Scan
During this phase, the initial vulnerability scan is conducted on the Server team's infrastructure. For our lab, this infrastructure is represented by a single server running Windows Server 2019. To simulate real-world conditions, prior to the scan, I have manually introduced several vulnerabilities on the server, including:
- Installing an outdated version of Wireshark.
- Adding the "Guest" account to the local Administrators group.
- Intentionally enabling insecure protocols and cipher suites within the OS.

After creating the vulnerabilities, a vulnerability scan was conducted. Several vulnerabilities were discovered in-line with our preparations.
Initial results can be found here: https://drive.google.com/file/d/1r4E35B6ha_7KKb1LsO_EhSh6T2vjHpbr/view?usp=drive_link
<p align="center">
<img width="471" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/2dd8f044-dc1c-4f09-941e-9eec5d6b9108">
</p>

## Vulnerability Assessment and Prioritization
In this phase, I assess the vulnerabilities discovered during the initial scan  

### Severity vs. Ease of Remediation
Although there are various methods for prioritization, for the sake of simplicity in the lab, I assumed all assets are of equal criticality. I prioritized vulnerabilities based on the ease of remediation and their criticality, focusing on addressing the easiest, highest-impact vulnerabilities first.
<p align="center">
<img width="50%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/0a626a8a-8720-4c7e-ba9a-2d4265535e61">
</p>

### The remediation order I opted for:
1. Third-Party: Wireshark Uninstall (highest cvss impact, easiest to remediate)
2. OS Configuration: Ciphers and Protocols (medium impact, easy to remediate)
3. OS Configuration: Remove Guest from Administrators Group (medium impact, easy to remediate)
4. OS Updates: Allow Windows to fully update itself (variable impact, passive remediation)
<p align="center">
<img width="50%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/26d2573d-5164-46ae-8894-dede65e44c34">
</p>

## Server Team Meeting: Post-Initial Discovery Scan
I meet up with the Server Team Manager again to discuss the results of a vulnerability scan, noting the successful completion without resource issues. We review specific vulnerabilities like outdated software and insecure settings, with plans to address them in an upcoming change control meeting. We express confidence in the remediation process, including the automatic resolution of some issues through scheduled updates.
<p align="center">
<img width="50%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/1ae26e86-dd9b-4249-bb86-8cb03dd03834">
</p>

## Creation of PowerShell Remediation Packages
In this phase, using a combination of Tenable's documentation, Google, and ChatGPT, I developed automated PowerShell remediation packages to ease the technical burden on the remediation teams. The package which will be brought to the Change Control Board (CAB) meeting includes scripts for the following:
- [Removal of Wireshark](https://github.com/joshmadakor1/lognpacific-public/blob/main/automation/remediation-wireshark-uninstall.ps1)
- [Removal of the Guest account from the Administrators Group](https://github.com/joshmadakor1/lognpacific-public/blob/main/automation/toggle-guest-local-administrators.ps1)
- [Removal of insecure cipher suites (e.g., 3DES)](https://github.com/joshmadakor1/lognpacific-public/blob/main/automation/toggle-cipher-suites.ps1)
- [Removal of insecure protocols (e.g., SSL 2.0)](https://github.com/joshmadakor1/lognpacific-public/blob/main/automation/toggle-win10-protocols.ps1)

## CAB Meeting: Change Request for Patching Insecure Protocols and Cipher Suites
In this phase, I attend a CAB meeting to discuss upcoming vulnerability remediations for the server team, specifically the removal of insecure protocols and cipher suites. During the meeting, the Server Manager defers to me to explain the PowerShell-based remediation solution and confirm a tiered deployment with rollback plans. The head system engineer expresses confidence in the simple registry updates involved. The meeting concludes with no further questions.
<p align="center">
<img width="50%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/420c6487-b691-413c-9fc1-bb935c137fe5">
</p>

## Vulnerability Remediation Phases
During this phase, we continue to go through the cycle of **(CAB -> Remediation -> Rescan)** until all vulnerabilities originally identified have been remediated.



<details>
<summary>Pre-remediation (Initial Scan)</summary>

---
Scan Report: [View full pre-rememdiation scan report](https://drive.google.com/file/d/1r4E35B6ha_7KKb1LsO_EhSh6T2vjHpbr/view?usp=drive_link)

This is the scan that was run prior to any remediation efforts.

<p align="center">
<img width="70%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/46b9702c-8fba-49b4-884c-7331746abd36">
</p>
</details>


<details>
<summary>Remediation (Round 1): Uninstall Wireshark</summary>

---
Scan Report: [View scan report after removing Wireshark](https://drive.google.com/file/d/1eysZjYmjz7ywMIgH3YK1V4feVaS3_qit/view?usp=drive_link)

Script: [Remediation Script: Wireshark Removal](https://github.com/joshmadakor1/lognpacific-public/blob/main/automation/remediation-wireshark-uninstall.ps1)

This PowerShell script checks if Wireshark 2.2.1 (64-bit) is installed by verifying the presence of its uninstaller executable, and if found, it silently uninstalls Wireshark using the specified uninstaller path and silent uninstall switch.

<p align="center">
<img width="70%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/377093ed-c744-48d7-88ed-87f1e4bb832e">
</p>
</details>

<details>
<summary>Remediation (Round 2): Disable insecure protocols and cipher suites</summary>

---
Scan Report: [View scan report after disabling insencure protocols and cipher suites](https://drive.google.com/file/d/1xHcGY02WGoOXze9wZwXEFRDBT1FEMiag/view?usp=drive_link)

Script: [Remediation Script: disable insencure cipher suites](https://github.com/joshmadakor1/lognpacific-public/blob/main/automation/toggle-cipher-suites.ps1)

Script: [Remediation Script: disable insencure protocols](https://github.com/joshmadakor1/lognpacific-public/blob/main/automation/toggle-protocols.ps1)

**First Script:** This PowerShell script ensures it runs with administrative privileges, then configures SSL/TLS settings based on the $makeSecure variable. It creates or modifies registry entries to disable or enable specific protocols (SSL 2.0, SSL 3.0, TLS 1.0, and TLS 1.1) and provides feedback to the user about the changes made, advising a reboot for the settings to take effect.

**Second Script:** This PowerShell script toggles between secure and insecure cipher suite configurations based on the $secureEnvironment variable. It updates the cipher suite order in the Windows registry and ensures the SSL Cipher Suite Order policy is enabled in Group Policy. The script then verifies the changes and prompts the user to restart the server for the settings to take effect.

<p align="center">
<img width="70%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/00643d5c-3701-4c0c-9120-a7f5afffb6de">
</p>
</details>

<details>
<summary>Remediation (Round 3): Remove Guest account from the Administrators group</summary>

---
Scan Report: [View full post-remediation remediation scan report](https://drive.google.com/file/d/1bKH-WHIoSs1Zq7HSqw3E21Naw3lfAGdN/view?usp=drive_link)

Script: [Remediation Script: Remove Guest Account From Local Administrators](https://github.com/joshmadakor1/lognpacific-public/blob/main/automation/toggle-guest-local-administrators.ps1)

This PowerShell script manages the membership of the Guest account in the local Administrators group based on the $AddGuestToAdminGroup variable. If set to $True, it adds the Guest account to the Administrators group if it isn't already a member; if set to $False, it removes the Guest account from the Administrators group if it is currently a member.

<p align="center">
<img width="70%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/e178e9c1-0254-4e37-b59a-23838610e609">
</p>
</details>

<details>
<summary>Remediation (Round 4): Complete all Windows OS updates</summary>

---
Scan Report: [Previous Vulnerability Scan](https://drive.google.com/file/d/1LBdEyG5lqYM-vurWilIyvMxJXCsguyFA/view?usp=drive_link)

Windows updates were run until the OS was fully updated, yet no more vulnerabilities were remediated since the 

<p align="center">
<img width="70%" alt="image" src="https://github.com/joshmadakor1/lognpacific-public/assets/39254979/e178e9c1-0254-4e37-b59a-23838610e609">
</p>
</details>

## Summary

After multiple verification scans, CAB reviews, and automation efforts, the vulnerabilities were reduced to a reasonable level. The vulnerabilities related to self-signed certificates were temporarily "accepted" while a PKI was being built, with plans to assign proper certificates to each server in the future.

**Final Vulnerability Count:**

- Critical: 0
- High: 1
- Medium: 4
- Low: 0

The organization is now in maintenance mode, utilizing existing remediations for known vulnerabilities and consulting the CAB for remediation when new vulnerabilities arise.
